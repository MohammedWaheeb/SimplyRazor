@namespace SW.SimplyRazor

<label for="@State.Id">@State.Text</label>

@if (inputType == "textarea")
{
    <textarea id="@State.Id"
              rows="3"
              value="@State.Value"
              class="form-control @((State.IsInvalid ? "is-invalid" : null))"
              disabled="@State.ReadOnly"
              @onchange="(e)=> ValueChanged.InvokeAsync(e.Value)"
              @attributes="UnmatchedAttributes">@State.Value</textarea>

}
else
{
    <input id="@State.Id"
           value="@State.Value"
           type="@inputType"
           class="form-control @((State.IsInvalid ? "is-invalid" : null))"
           disabled="@State.ReadOnly"
           @onchange="(e)=> ValueChanged.InvokeAsync(e.Value)"
           @attributes="UnmatchedAttributes" />
}

@code {

    [Parameter]
    public EventCallback<object> ValueChanged { get; set; }

    [Parameter]
    public IField State { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object> UnmatchedAttributes { get; set; }

    string inputType;

    protected override void OnInitialized()
    {
        var nakedType = Nullable.GetUnderlyingType(State.PropertyInfo.PropertyType) ?? State.PropertyInfo.PropertyType;

        if (nakedType == typeof(int))
        {
            inputType = "number";
        }
        else if (nakedType == typeof(DateTime))
        {
            inputType = "date";
        }
        else if (State.PropertyInfo.PropertyType == typeof(string))
        {
            switch (State.InputType)
            {

                case InputType.Multiline:

                    inputType = "textarea";
                    break;

                case InputType.Password:

                    inputType = "password";
                    break;

                case 0:
                    inputType = "text";
                    break;

            }

        }
        else
        {
            inputType = "text";
        }
    }

}
